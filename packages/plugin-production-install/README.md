# Yarn Plugin Production Install

This plugin will create a minimal yarn install for a workspace.
`yarn prod-install outDir`
The resulting installation will include only `dependencies` required for production.
It excludes `devDependencies`. The yarn cache will be copied and trimmed accordingly.
Yarn settings and plugins are included.

## Install instructions

```
yarn plugin import https://gitlab.com/Larry1123/yarn-contrib/-/raw/master/packages/plugin-production-install/bundles/@yarnpkg/plugin-production-install.js
```

## Example Dockerfile


```dockerfile
# syntax = docker/dockerfile:experimental

##
## Base node image used to set up the production build
##
FROM node:12-alpine as builder
WORKDIR /usr/src/app

##
## Add all files from the current directory (if you need to ignore anything, you can use .dockerignore)
##
ADD . .

##
## This is needed as the install state will be invalid otherwise
##
RUN yarn install

##
## Optionally compile (tsc, babel, etc) your source files to /packages/backend-api/dist
##
RUN yarn workspace backend-api build 

##
## This is our secret weapon
## Our nice plugin creates a yarn install just for us
##
RUN cd packages/backend-api && yarn prod-install /usr/src/build

##
## Copy /dist directory to built image
##
RUN cp -r packages/backend-api/dist /usr/src/build

##
## This is our actual built image
##
FROM node:12-alpine 
WORKDIR /usr/src/app

##
## Just copy all the files generated by the builder image 
##
COPY --from=builder /usr/src/build .

##
## Expose our port and run the production app, assumes `backend-api/package.json` has a script named `start:prod`
##
EXPOSE 4020
CMD ["yarn", "start:prod"]
```
